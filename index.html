<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trickerion: Legends of Illusion</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;500;600;700;800;900&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">

  <!-- GSAP 3.12 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>

  <!-- tsParticles 2.12 -->
  <script src="https://cdn.jsdelivr.net/npm/tsparticles-engine@2.12.0/tsparticles.engine.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/tsparticles-slim@2.12.0/tsparticles.slim.bundle.min.js" defer></script>

  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" defer></script>

  <link rel="stylesheet" href="src/css/style.css">
</head>
<body>

  <!-- SVG Sprites (loaded dynamically) -->
  <div id="svg-sprites" style="display:none"></div>

  <!-- Particle Container -->
  <div id="particles-js"></div>

  <!-- Decorative Magic Circles -->
  <div class="magic-circle magic-circle-tl" aria-hidden="true"></div>
  <div class="magic-circle magic-circle-br" aria-hidden="true"></div>

  <div id="app">

    <!-- ========== TITLE SCREEN ========== -->
    <div id="title-screen" class="screen">
      <div class="title-magic-bg" aria-hidden="true">
        <div class="rune-circle rune-circle-slow"></div>
        <div class="rune-circle rune-circle-reverse"></div>
      </div>
      <div class="title-content">
        <div class="title-logo">
          <svg class="title-logo-icon"><use href="#icon-magician"/></svg>
        </div>
        <h1 class="title-main">TRICKERION</h1>
        <div class="title-ornament"></div>
        <div class="subtitle">Legends of Illusion</div>
        <p class="title-desc">
          스팀펑크 도시 마고리아에서 전설적인 마법사가 되어<br>
          최고의 명성을 얻으세요!
        </p>
        <div class="title-buttons">
          <button class="btn btn-primary btn-lg btn-steam" onclick="window.gameUI.showSetup()">
            <svg class="btn-icon"><use href="#icon-play"/></svg>
            새 게임 시작
          </button>
          <button class="btn btn-lg" onclick="window.gameUI.showLoadModal()">
            <svg class="btn-icon"><use href="#icon-play"/></svg>
            이어하기
          </button>
          <button class="btn btn-lg" onclick="window.gameUI.showRules()">
            <svg class="btn-icon"><use href="#icon-rules"/></svg>
            게임 규칙
          </button>
        </div>
        <div class="title-footer">
          Based on the board game Trickerion by Mindclash Games
        </div>
      </div>
    </div>

    <!-- ========== SETUP SCREEN ========== -->
    <div id="setup-screen" class="screen" style="display:none">
      <div class="setup-container">
        <div class="setup-header">
          <h1>
            <svg class="heading-icon"><use href="#icon-magician"/></svg>
            게임 설정
          </h1>
          <p class="setup-subtitle">플레이어를 설정하고 게임을 시작하세요</p>
        </div>
        <div class="setup-player-count">
          <label>플레이어 수:</label>
          <select id="num-players" onchange="window.gameUI.renderSetup()">
            <option value="2">2명</option>
            <option value="3">3명</option>
            <option value="4">4명</option>
          </select>
        </div>
        <div id="setup-players" class="player-setup-grid"></div>
        <div class="setup-actions">
          <button class="btn" onclick="window.gameUI.showTitle()">
            <svg class="btn-icon" style="transform:rotate(180deg)"><use href="#icon-arrow-right"/></svg>
            뒤로
          </button>
          <button class="btn btn-primary btn-lg btn-steam" onclick="window.gameUI.startGame()">
            <svg class="btn-icon"><use href="#icon-play"/></svg>
            게임 시작!
          </button>
        </div>
      </div>
    </div>

    <!-- ========== GAME SCREEN ========== -->
    <div id="game-screen" class="screen" style="display:none">
      <div class="top-bar">
        <div class="round-info">
          <span class="round-badge" id="round-badge">라운드 1 / 7</span>
          <span class="phase-badge" id="phase-badge">셋업</span>
        </div>
        <div class="player-tabs" id="player-tabs"></div>
        <div>
          <button class="btn btn-sm btn-icon-only" onclick="window.gameUI.showRules()" title="게임 규칙">
            <svg class="btn-icon"><use href="#icon-rules"/></svg>
          </button>
        </div>
      </div>
      <div class="game-layout">
        <div class="left-panel" id="player-board">
          <div class="panel-section">
            <div class="panel-section-title">
              <svg class="section-icon"><use href="#icon-coin"/></svg> 자원
            </div>
            <div class="player-stats">
              <div class="stat-box fame">
                <div class="value" id="stat-fame">5</div>
                <div class="label"><svg class="stat-icon"><use href="#icon-fame"/></svg> 명성</div>
              </div>
              <div class="stat-box coins">
                <div class="value" id="stat-coins">10</div>
                <div class="label"><svg class="stat-icon"><use href="#icon-coin"/></svg> 코인</div>
              </div>
              <div class="stat-box shards">
                <div class="value" id="stat-shards">1</div>
                <div class="label"><svg class="stat-icon"><use href="#icon-shard"/></svg> 샤드</div>
              </div>
              <div class="stat-box">
                <div class="value" id="stat-tricks-count">1</div>
                <div class="label"><svg class="stat-icon"><use href="#icon-trick"/></svg> 트릭</div>
              </div>
            </div>
          </div>
          <div class="panel-section">
            <div class="panel-section-title">
              <svg class="section-icon"><use href="#icon-magician"/></svg> 캐릭터
            </div>
            <div class="character-list" id="character-list"></div>
          </div>
          <div class="panel-section">
            <div class="panel-section-title">
              <svg class="section-icon"><use href="#icon-trick"/></svg> 트릭
            </div>
            <div class="trick-list" id="trick-list"></div>
          </div>
          <div class="panel-section">
            <div class="panel-section-title">
              <svg class="section-icon"><use href="#icon-component"/></svg> 컴포넌트
            </div>
            <div class="component-grid" id="component-grid"></div>
          </div>
        </div>
        <div class="center-panel" id="main-board"></div>
        <div class="right-panel">
          <div class="action-panel" id="action-panel">
            <h3>
              <svg class="heading-icon-sm"><use href="#icon-ap"/></svg> 액션
            </h3>
            <div id="action-content"></div>
          </div>
          <div class="log-panel">
            <div class="log-header">
              <svg class="section-icon"><use href="#icon-trick"/></svg> 게임 로그
            </div>
            <div class="log-content" id="log-content"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== RULES SCREEN ========== -->
    <div id="rules-screen" class="screen" style="display:none">
      <div class="rules-container">
        <button class="btn" onclick="window.gameUI.showTitle()">
          <svg class="btn-icon" style="transform:rotate(180deg)"><use href="#icon-arrow-right"/></svg> 뒤로
        </button>
        <h1><svg class="heading-icon"><use href="#icon-rules"/></svg> 트릭케리언 게임 규칙</h1>
        <div class="rules-content">
          <h2>개요</h2>
          <p>트릭케리언은 2-4명의 플레이어가 스팀펑크 도시 마고리아에서 마법사가 되어 경쟁하는 전략 보드게임입니다.</p>
          <p>7라운드에 걸쳐 가장 높은 명성을 얻는 플레이어가 승리합니다.</p>
          <h2>라운드 구조</h2>
          <ol>
            <li><strong>주사위 굴림</strong>: 다운타운 주사위를 굴려 이번 라운드의 옵션을 결정</li>
            <li><strong>이니셔티브</strong>: 명성이 낮은 순서대로 우선권</li>
            <li><strong>광고</strong>: 코인을 지불하여 2명성 획득 가능</li>
            <li><strong>배정</strong>: 캐릭터를 각 장소에 배정</li>
            <li><strong>캐릭터 배치</strong>: 이니셔티브 순서대로 교대로 캐릭터를 배치하고 액션 수행</li>
            <li><strong>퍼포먼스</strong>: 극장에서 마법 공연 진행</li>
            <li><strong>턴 종료</strong>: 급여 지급, 시장 주문 도착, 퍼포먼스 카드 이동</li>
          </ol>
          <h2>장소</h2>
          <h3><svg class="inline-icon"><use href="#icon-downtown"/></svg> 다운타운</h3>
          <ul>
            <li><strong>트릭 배우기 (3 AP)</strong>: 새 트릭 학습</li>
            <li><strong>코인 받기 (3 AP)</strong>: 은행 주사위만큼 코인 획득</li>
            <li><strong>캐릭터 고용 (3 AP)</strong>: 여관 주사위에 따라 캐릭터 고용</li>
          </ul>
          <h3><svg class="inline-icon"><use href="#icon-market"/></svg> 시장</h3>
          <ul>
            <li><strong>구매 (1 AP)</strong>: 컴포넌트 구매</li>
            <li><strong>주문 (1 AP)</strong>: 다음 턴에 도착할 컴포넌트 주문</li>
          </ul>
          <h3><svg class="inline-icon"><use href="#icon-workshop"/></svg> 작업장</h3>
          <ul><li><strong>트릭 준비 (가변 AP)</strong>: 컴포넌트를 소모하여 트릭 마커 생성</li></ul>
          <h3><svg class="inline-icon"><use href="#icon-theater"/></svg> 극장</h3>
          <ul>
            <li><strong>트릭 셋업 (1 AP)</strong>: 준비된 트릭 마커를 퍼포먼스 카드에 배치</li>
            <li><strong>공연</strong>: 퍼포먼스 페이즈에서 공연 수행</li>
          </ul>
          <h3><svg class="inline-icon"><use href="#icon-darkAlley"/></svg> 어둠의 골목</h3>
          <ul><li><strong>특수 임무 획득 (1 AP)</strong>: 2장 뽑아 1장 선택</li></ul>
          <h2>퍼포먼스</h2>
          <p>트릭 마커를 퍼포먼스 카드에 배치하고, 같은 카테고리의 인접 마커가 '링크'를 만들면 보너스 명성을 얻습니다.</p>
          <h2>게임 종료</h2>
          <p>7라운드 후 최종 점수 계산: 샤드, 특수 임무, 레벨3 트릭 보너스, 잔여 코인으로 추가 명성을 얻습니다.</p>
        </div>
      </div>
    </div>

    <!-- ========== MODAL ========== -->
    <div id="modal-overlay" class="modal-overlay">
      <div class="modal" id="modal"></div>
    </div>
  </div>

  <script type="module">
    // Load SVG sprites
    fetch('src/svg/sprites.svg')
      .then(r => r.text())
      .then(svg => { document.getElementById('svg-sprites').innerHTML = svg; })
      .catch(() => console.warn('SVG sprites not loaded'));

    import { GameUI } from './src/js/ui.js';
    const ui = new GameUI();
    window.gameUI = ui;
    ui.showRules = function() { ui.showScreen('rules-screen'); };
    ui.showTitle();
  </script>
</body>
</html>
