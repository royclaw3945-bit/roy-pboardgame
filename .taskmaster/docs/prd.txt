# Trickerion: Legends of Illusion - 완전한 보드게임 구현 PRD

## 프로젝트 목표
Trickerion 보드게임의 원본 규칙을 웹 기반으로 **완벽하게** 구현한다. 현재 코드는 규칙이 대부분 잘못되어 있으므로 처음부터 재설계한다.

## 기술 스택
- 순수 HTML/CSS/JS (ES Modules)
- Supabase 백엔드 (이미 연결됨)
- Vercel 배포 (이미 설정됨)
- 300줄 이내 파일 분할 규칙 유지

---

## Phase 1: 게임 데이터 완전 교체

### Task 1.1: 트릭 카드 데이터 교체 (48장)
실제 룰북 기반 48장 트릭 데이터로 교체. 모든 트릭의 이름, 컴포넌트, yields(명성/코인/샤드)를 정확한 데이터로 변경.

**기계(Mechanical) 12장:**
- Level 1: Linking Rings, Living Piano, Chinese Sticks, Levitation
- Level 2: Mechanical Hornet, Sawing the Assistant, Vanishing Bird Cage, Bullet Catch
- Level 3: Aztec Lady, Horror Saws, Automaton, Hellhound

**광학(Optical) 12장:**
- Level 1: Enchanted Butterflies, Rabbit from Top Hat, Pub-In-A-Bottle, Card Manipulation
- Level 2: Self Decapitation, Paper Shred, Shattered Mirror, Fishing in the Air
- Level 3: Mutilation, Stairs of Water, Beast Within, Vanishing Elephant

**탈출(Escape) 12장:**
- Level 1: Barricaded Barrels, Stocks Escape, Burning Mummy, Water Tank Escape
- Level 2: Prison Break, Zig Zag Lady, Walled, Wolf Cage
- Level 3: Buried Alive, Assistant's Revenge, Iron Maiden, Transported Man

**영혼(Spiritual) 12장:**
- Level 1: Mind Reading, Breath of Life, Spirit Hand, Window to the Otherworld
- Level 2: Floating Table, Future Sight, Pepper's Ghost, Ghost Trap
- Level 3: Balsamo's Skull, Seance, Skeleton Dance, Metamorphosis

각 트릭에는 이름, 카테고리, 레벨, fameThreshold(1/16/36), 필요 컴포넌트(종류와 수량), prepareCost(AP), markerSlots(트릭마커수), yields(fame/coins/shards)가 포함.

### Task 1.2: 게임 상수 수정
- 시작 명성: 5 → **10**
- 시작 코인: 10 균일 → **10/12/14/16** (이니셔티브 순서별)
- 전문가 임금: 1코인 → **2코인**
- 견습생 임금: 1코인 유지
- 임금 미지불 페널티: 부족 1코인당 **2명성 차감**
- 영구 배정 카드: 6장 → **9장** (극장3, 작업장2, 시장2, 다운타운2)
- 게임 라운드: 기본 **5라운드** (Dark Alley 확장 시 7라운드)
- 트릭 슬롯: 기본 **4개** (기술자 보너스 +1)
- 트릭 마커: 미사용 풀 **6개**
- 컴포넌트 최대 보유: 종류당 **3개**

### Task 1.3: 마법사 데이터 수정
기본 4인 마법사 정보 수정:
- The Mechaniker (기계) - Gerhard von Liebenstein
- The Great Optico (광학) - Leo Sanderberg
- Master of Chains (탈출) - Frederic White
- Priestess of Mysticism (영혼) - Amabel Fae

베이스 게임에서는 마법사 고유 능력이 **없음**. Dahlgaard's Gifts 확장에서만 활성화.
추후 확장 시 8인 마법사 추가.

---

## Phase 2: 핵심 게임 엔진 재설계

### Task 2.1: 라운드 구조 재설계 (7 페이즈)
1. Roll Dice (주사위 굴림)
2. Set Initiative Order (이니셔티브 결정 - 명성 낮은 순)
3. Advertise (광고 - 코인→명성)
4. Assignment (동시 비밀 배정)
5. Place Characters & Execute Actions (교대 배치+액션)
6. Performance (공연)
7. End Turn (턴 종료 - 6단계)

### Task 2.2: 배정(Assignment) 시스템 재설계
- **동시 비밀 배정**: 모든 플레이어가 동시에, 비밀리에 배정 카드를 각 캐릭터에 배치
- 영구 배정 카드 9장 관리
- 유휴(Idle) 캐릭터: 배정하지 않으면 임금 불필요
- Dark Alley 확장: 특수 배정 카드 (1회용, +1AP 또는 특수효과 선택)
- 한 장소에 여러 캐릭터 배정 시 같은 장소 카드 여러 장 필요
- 동시 공개 후 이니셔티브 순서대로 1캐릭터씩 교대 배치

### Task 2.3: AP 시스템 재설계
- 기본 AP: 마법사 3, 전문가 2, 견습생 1
- 슬롯 수정치: 각 장소의 슬롯에 인쇄된 +1/0/-1 수정치
- 먼저 도착할수록 좋은 슬롯(+1) 선점
- **샤드→AP 변환**: 1 트릭케리언 샤드 소비 = +1AP (극장 제외, 배치당 최대 1회)
- 특수 배정 카드 버리기: +1AP

### Task 2.4: 컴포넌트 비소비 규칙
**가장 중요한 규칙 변경**: 트릭 준비(Prepare) 시 컴포넌트는 **소비되지 않음**.
- 준비 시 작업장에 필요한 컴포넌트가 **존재하는지만 확인**
- 컴포넌트는 그대로 유지됨
- 같은 컴포넌트로 여러 트릭을 준비할 수 있음
- 매니저 멀티 컴포넌트 슬롯: 해당 슬롯의 컴포넌트는 +1개로 계산

---

## Phase 3: 각 장소 액션 완전 구현

### Task 3.1: 다운타운(Downtown) 재설계
3개 하위 장소를 포함하는 복합 장소:
- **달가드 저택**: 트릭 배우기 (3AP) - 주사위 카테고리 기반 필터링 + 선호 카테고리 항상 가능
- **여관**: 캐릭터 고용 (3AP) - 전문가(기술자/매니저/어시스턴트) 각 1명 제한, 견습생 무제한
- **은행**: 코인 받기 (3AP) - 은행 주사위 면 숫자만큼
- **공통**: 주사위 재굴림 (1AP), 주사위 설정 (2AP)

### Task 3.2: 시장(Market Row) 재설계
- **구매(Buy)**: 1AP, 같은 종류 최대 3개, 가격 = 등급별 (기본1/고급2/최상급3)
- **흥정(Bargain)**: 1AP, Buy와 함께 사용, AP당 총 가격 1코인 할인
- **주문(Order)**: 1AP, 다음 턴에 Buy 영역으로 이동
- **긴급주문(Quick Order)**: 2AP, 이번 턴 중 +1코인으로 구매 가능
- 컴포넌트 12종 정확한 가격 체계

### Task 3.3: 작업장(Workshop) 재설계
- 개인 보드 위의 장소
- **준비(Prepare)**: 1~3AP, 컴포넌트 보유 확인만 (비소비!), 트릭 마커 배치
- 기술자 슬롯: 준비 시 +1 트릭 마커
- 매니저 멀티 컴포넌트 슬롯: 컴포넌트 +1 효과
- 어시스턴트 견습생 슬롯: 해당 견습생 임금 면제
- 트릭 이동(1AP, 기술자), 컴포넌트 이동(1AP, 매니저), 견습생 이동(1AP, 어시스턴트)

### Task 3.4: 극장(Theater) 재설계
- **요일 시스템**: 목/금/토/일 4요일. 한 플레이어의 모든 캐릭터는 같은 요일에만 배치
- **트릭 셋업(1AP)**: 트릭 마커를 퍼포먼스 카드 빈 슬롯으로 이동
- **일정 변경(1AP)**: 자기 트릭 마커를 다른 빈 슬롯으로 이동 (링크 보너스 없음)
- **공연(Perform)**: 마법사 전용, 퍼포먼스 슬롯에 배치
- **링크 시스템**: 같은 카테고리 심볼 2개가 같은 링크 서클에 위치하면 링크
  - 링크 보너스: 트릭 레벨에 따라 1/2/3 명성 **또는** 코인 (선택)
  - 샤드 심볼 있는 링크 서클: 참여한 모든 플레이어에게 1샤드

### Task 3.5: 어둠의 골목(Dark Alley) 재설계
- **카드 뽑기(1AP)**: 특수 배정 카드 2장 뽑고 1장 선택
- **추가 뽑기(2AP)**: 연속 뽑기
- **점술(Fortune Telling, 1AP)**: 예언 토큰 조작

---

## Phase 4: 퍼포먼스 페이즈 완전 구현

### Task 4.1: 퍼포먼스 실행 로직
- **요일 순서**: 목→금→토→일 순서로 처리
- 해당 요일 퍼포먼스 슬롯에 마법사가 있는 플레이어가 공연
- **수확물 분배**: 카드에 마커가 있는 모든 플레이어가 자기 트릭의 수확물 수령
- **요일 수정치**: 목(-1/-1), 금(0/0), 토(0/0), 일(+1/+1) - 각 트릭에 적용

### Task 4.2: 리드 퍼포머 보너스
- 퍼포먼스 카드 하단 보너스 (명성/코인/샤드)
- 해당 카드 내 트릭 링크 1개당 1명성
- 극장 전문가 보너스: 기술자→1샤드, 매니저→2코인, 어시스턴트→1명성

### Task 4.3: 퍼포먼스 카드 관리
- Riverside Theater, Grand Magorian, Magnus Pantheon 각 2장
- 정확한 슬롯 레이아웃과 링크 서클 위치
- 카드 이동: 매 턴 종료 시 시계방향 1칸, 마지막 카드 버림, 새 카드 추가
- 카드 버릴 때 남은 마커는 소유자의 미사용 풀로 반환

---

## Phase 5: 턴 종료 & 게임 종료 재설계

### Task 5.1: 턴 종료 6단계
a) 임금 지불: 견습생 1코인, 전문가 2코인. 어시스턴트 슬롯 견습생은 면제. 미지불 1코인당 2명성 차감
b) 캐릭터 귀환: 모든 캐릭터 개인 보드로
c) 주문 도착: Order→Buy 이동
d) 퍼포먼스 카드 이동: 시계방향 1칸
e) 포스터 제거: 광고 포스터 회수
f) 턴 카운터 이동

### Task 5.2: 최종 점수 계산
베이스 게임:
- 트릭케리언 샤드: 1개당 1명성
- 남은 코인: 3개당 1명성
- 견습생: 1명당 2명성
- 전문가: 1명당 3명성

Dark Alley 확장:
- 샤드: 3개당 2명성 (최대 20)
- 코인: 3개당 1명성 (최대 20)
- 미사용 특수 배정 카드: 1장당 2명성 (최대 20)
- Level 3 트릭 조건 보너스 (최대 20)

타이브레이커: 이니셔티브 순서에서 앞에 있는 플레이어 승리

---

## Phase 6: UI 완전 재설계

### Task 6.1: 게임 셋업 화면 개선
- 마법사 선택 (4인 선택, 중복 불가)
- 전문가 선택 (기술자/매니저/어시스턴트)
- 시작 트릭 선택 (선호 카테고리 Level 1 중 1장)
- 시작 컴포넌트 선택
- 플레이어 수(2~4인) 선택

### Task 6.2: 동시 비밀 배정 UI
- 배정 카드를 드래그&드롭 또는 클릭으로 캐릭터에 배치
- 다른 플레이어의 배정은 숨김
- "배정 완료" 버튼으로 동시 공개
- 유휴 캐릭터 선택 옵션

### Task 6.3: 극장/퍼포먼스 UI 개선
- 요일별 캐릭터 슬롯 시각화
- 퍼포먼스 카드의 트릭 슬롯과 링크 서클 정확한 레이아웃
- 링크 생성 시 애니메이션 및 보상 선택 UI (명성 vs 코인)
- 공연 결과 상세 표시

### Task 6.4: 개인 보드(작업장) UI 개선
- 트릭 슬롯 4~5개 시각화
- 컴포넌트 보유 현황 (비소비 규칙 반영)
- 매니저/기술자/어시스턴트 보드 확장 슬롯
- 트릭 마커 풀 표시

### Task 6.5: 메인 보드 UI 개선
- 각 장소의 워커 슬롯과 AP 수정치 표시
- 플레이어 수에 따른 슬롯 잠금 시각화
- 주사위 결과 및 조작 UI
- 시장 컴포넌트 진열대 UI

---

## Phase 7: 테스트 & 밸런싱

### Task 7.1: 전체 게임 플로우 테스트
- 2인/3인/4인 게임 각각 테스트
- 모든 페이즈 전환 확인
- 모든 액션 동작 확인
- 최종 점수 계산 정확성 확인

### Task 7.2: 에지 케이스 처리
- 코인 부족 시 임금 지불 처리
- 명성 0 미만 방지
- 트릭 슬롯 가득 찬 경우
- 퍼포먼스 카드 덱 소진 시
- 컴포넌트 풀 소진 시

---

## 구현 규칙
- 모든 코드 파일은 **300줄 이내**
- 기존 모듈 구조 유지 (engine-core, engine-actions, engine-perf, gameData, tricks, ui 등)
- 파일 분할 필요 시 새 모듈 생성
- Supabase 저장/불러오기 호환성 유지
